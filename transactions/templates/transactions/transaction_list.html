{% extends "account/base.html" %}

{% block title %}明細一覧{% endblock %}

{% block content %}
<h2>明細一覧</h2>

<p>
  <a href="{% url 'transactions:to_confirm' %}">要確認（未CK）明細だけを見る</a>
</p>

<p>
    <a href="{% url 'home' %}">← トップに戻る</a>
    <a href="{% url 'transactions:create' %}">明細を新しく登録する</a>
    <a href="{% url 'transactions:unassigned' %}">未仕分けの明細を仕分けする</a>
    <a href="{% url 'transactions:upload_csv' %}">CSVを取り込む</a>
    <a href="{% url 'transactions:monthly_summary' %}">カテゴリ別サマリを見る</a>
</p>

<div class="transaction-search">
  <label for="transactionSearchInput">明細を検索：</label>
  <input
    type="text"
    id="transactionSearchInput"
    placeholder="カテゴリ / メモ / 店名 / 金額 などで絞り込み"
  />
</div>


<table id="transactionTable" class="kakeibo-table">
    <tr>
        <th>日付</th>
        <th>店名・サービス名</th>
        <th>金額</th>
        <th>誰の出費か</th>
        <th>カテゴリ</th>
        <th>判定方法</th>
        <th>メモ</th>
    </tr>
    {% for t in transactions %}
    <tr>
        <td>{{ t.formatted_date }}</td>
        <td>{{ t.shop }}</td>
        <td class="num">{{ t.amount }} 円</td>
        <td>{{ t.member.short_name }}</td>
        <td>{{ t.category }}</td>

        <td>
            {{ t.get_decided_by_display }}
            {# Django が自動で choices の日本語ラベルを返してくれるやつ #}
        </td>

        <td>{{ t.memo }}</td>
    </tr>
    {% empty %}
    <tr>
        <td colspan="7">まだ明細は登録されていません。</td>
    </tr>
    {% endfor %}
</table>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const input = document.getElementById("transactionSearchInput");
    const table = document.getElementById("transactionTable");
    if (!input || !table) return;

    // すべての行を取得
    const allRows = Array.from(table.querySelectorAll("tr"));

    // 最初の行（ヘッダー）は除外、それ以降がデータ
    const dataRows = allRows.slice(1);

    input.addEventListener("input", function () {
        const keyword = input.value.trim().toLowerCase();

        dataRows.forEach((row) => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(keyword) ? "" : "none";
        });
    });
});
</script>

{% endblock %}
