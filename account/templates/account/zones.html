{% extends "account/base.html" %}
{% load humanize %}
{% block title %}Zones{% endblock %}

{% block content %}
<h1>Zones</h1>

{% if not has_data %}
  <div class="card">
    <p class="muted">データがないため表示できません。</p>
  </div>
{% else %}

<div class="card">
  <h2 class="h2">前提条件</h2>
  <ul class="muted">
    <li>対象：食品・日用品／外食／娯楽</li>
    <li>今月：{{ current_month }}</li>
    <li>基準：直近{{ n_base }}請求月（今月を除く）</li>
    <li class="muted">※「使いすぎ」を断定するものではなく、過去の自分たち基準の目安です。</li>
  </ul>
</div>

<div class="card">
  <h2 class="h2">カテゴリ別：今月のゾーン</h2>

  <table class="summary-table">
    <thead>
      <tr>
        <th>カテゴリ</th>
        <th class="num">今月</th>
        <th class="num">中央値</th>
        <th class="num">高めライン(75%)</th>
        <th class="num">差分（今月-中央値）</th>
        <th>ゾーン</th>
      </tr>
    </thead>
    <tbody>
      {% for r in cards %}
      <tr>
        <td>{{ r.name }}</td>
        <td class="num">¥{{ r.current|intcomma }}</td>
        <td class="num">¥{{ r.median|intcomma }}</td>
        <td class="num">¥{{ r.p75|intcomma }}</td>
        <td class="num">{% if r.delta >= 0 %}+{% endif %}¥{{ r.delta|intcomma }}</td>
        <td>{{ r.zone }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<div class="card">
  <h2 class="h2">増減の寄与（どこが効いてるか）</h2>
  <p class="muted">中央値との差分が大きい順に並べています。</p>

  <table class="summary-table">
    <thead>
      <tr>
        <th>カテゴリ</th>
        <th class="num">差分（今月-中央値）</th>
      </tr>
    </thead>
    <tbody>
      {% for r in contrib %}
      <tr>
        <td>{{ r.name }}</td>
        <td class="num">{% if r.delta >= 0 %}+{% endif %}¥{{ r.delta|intcomma }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endif %}
{% endblock %}
